{% extends "base.html" %}

{% block title %}TMHKchat - ãƒ­ã‚°ã‚¤ãƒ³{% endblock %}

{% block head_style %}
<style>
    /* ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒ†ãƒŠ */
    .container {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(25px); /* ã™ã‚Šã‚¬ãƒ©ã‚¹åŠ¹æœ */
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        padding: 2.5rem;
        width: 90%;
        max-width: 450px;
        text-align: center;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        opacity: 0; /* GSAPã§ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
    }

    /* ã‚¿ã‚¤ãƒˆãƒ« */
    h1 {
        font-size: 2.5rem;
        font-weight: 500;
        color: #fff;
        margin-top: 0;
        margin-bottom: 0.5rem;
        letter-spacing: 2px;
    }

    /* èª¬æ˜æ–‡ */
    p {
        margin-bottom: 2rem;
        font-weight: 300;
        opacity: 0.8;
    }

    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
    .input-group {
        position: relative;
        margin-bottom: 1.5rem;
    }

    input[type="text"], input[type="password"] {
        width: 100%;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-color);
        font-size: 1.125rem;
        font-family: var(--font-family);
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    input[type="text"]::placeholder, input[type="password"]::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    input[type="text"]:focus, input[type="password"]:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 15px rgba(159, 120, 255, 0.5);
    }

    /* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
    .password-toggle {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        font-size: 1rem;
        padding: 0;
        width: auto;
        transition: color 0.3s ease;
    }

    .password-toggle:hover {
        color: var(--primary-color);
        transform: translateY(-50%) scale(1.1);
        box-shadow: none;
    }

    /* ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .validation-message {
        color: rgba(255, 100, 100, 0.8);
        font-size: 0.9rem;
        margin-top: 0.5rem;
        text-align: left;
    }

    /* é€ä¿¡ãƒœã‚¿ãƒ³ */
    button[type="submit"] {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 10px;
        background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        color: #fff;
        font-size: 1.25rem;
        font-family: var(--font-family);
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
    }

    button[type="submit"]:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    button[type="submit"]:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    
    /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .flash-message {
        padding: 1rem;
        background-color: rgba(255, 0, 60, 0.5); /* var(--danger-color)ã‚’åŠé€æ˜ã« */
        color: white;
        border-radius: 10px;
        margin-bottom: 1rem;
        border: 1px solid var(--danger-color);
    }

    /* ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º */
    .mode-indicator {
        background: rgba(159, 120, 255, 0.2);
        border: 1px solid rgba(159, 120, 255, 0.3);
        border-radius: 10px;
        padding: 0.8rem;
        margin-bottom: 1.5rem;
        color: var(--primary-color);
        font-size: 0.95rem;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Œã°è¡¨ç¤º -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-message">
                {{ messages[0] }}
            </div>
        {% endif %}
    {% endwith %}

    <h1 class="anim-item">TMHKchat</h1>
    <p class="anim-item">èªè¨¼</p>
    
    <!-- ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º -->
    <div class="mode-indicator anim-item" id="modeIndicator">
        æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
    </div>
    
    <form method="POST" class="anim-item" id="authForm">
        <div class="input-group">
            <input type="text" name="username" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" required autocomplete="username">
        </div>
        
        <div class="input-group">
            <input type="password" name="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ› (2æ–‡å­—ä»¥ä¸Š)" required autocomplete="current-password" minlength="2">
            <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">ğŸ‘</button>
            <div class="validation-message" id="passwordValidation" style="display: none;">
                ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯2æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„
            </div>
        </div>
        
        <button type="submit" id="submitButton">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
    </form>
</div>
{% endblock %}

{% block body_script %}
<script>
    // GSAPã‚’ä½¿ã£ã¦è¦ç´ ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ãŒãµã‚ã£ã¨è¡¨ç¤ºã•ã‚Œã‚‹
    gsap.to(".container", {
        duration: 1.5,
        opacity: 1,
        ease: "expo.out"
    });

    // ã‚³ãƒ³ãƒ†ãƒŠå†…ã®å„è¦ç´ ãŒå°‘ã—é…ã‚Œã¦ä¸‹ã‹ã‚‰é †ç•ªã«è¡¨ç¤ºã•ã‚Œã‚‹
    gsap.from(".anim-item", {
        duration: 1,
        opacity: 0,
        y: 30, // 30pxä¸‹ã‹ã‚‰
        stagger: 0.2, // 0.2ç§’ãšã¤ãšã‚‰ã—ã¦
        delay: 0.5, // 0.5ç§’å¾Œã‹ã‚‰é–‹å§‹
        ease: "power3.out"
    });

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password');
        const toggleButton = document.querySelector('.password-toggle');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleButton.textContent = 'ğŸ™ˆ';
        } else {
            passwordInput.type = 'password';
            toggleButton.textContent = 'ğŸ‘';
        }
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    document.getElementById('password').addEventListener('input', function() {
        const password = this.value;
        const validationMessage = document.getElementById('passwordValidation');
        const submitButton = document.getElementById('submitButton');
        
        if (password.length < 2 && password.length > 0) {
            validationMessage.style.display = 'block';
            submitButton.disabled = true;
        } else {
            validationMessage.style.display = 'none';
            submitButton.disabled = false;
        }
    });

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›æ™‚ã«ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã©ã†ã‹ï¼‰
    let userCheckTimeout;
    document.getElementById('username').addEventListener('input', function() {
        const username = this.value.trim();
        const modeIndicator = document.getElementById('modeIndicator');
        const submitButton = document.getElementById('submitButton');
        
        // å…¥åŠ›åœæ­¢ã‹ã‚‰500mså¾Œã«ãƒã‚§ãƒƒã‚¯
        clearTimeout(userCheckTimeout);
        if (username.length >= 2) {
            userCheckTimeout = setTimeout(() => {
                // ç°¡æ˜“çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿéš›ã®ãƒã‚§ãƒƒã‚¯ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§è¡Œã†ï¼‰
                fetch('/check_user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({username: username})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        modeIndicator.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
                        modeIndicator.style.background = 'rgba(162, 210, 255, 0.2)';
                        modeIndicator.style.borderColor = 'rgba(162, 210, 255, 0.3)';
                        modeIndicator.style.color = 'var(--secondary-color)';
                        submitButton.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
                    } else {
                        modeIndicator.textContent = 'æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²';
                        modeIndicator.style.background = 'rgba(159, 120, 255, 0.2)';
                        modeIndicator.style.borderColor = 'rgba(159, 120, 255, 0.3)';
                        modeIndicator.style.color = 'var(--primary-color)';
                        submitButton.textContent = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }, 500);
        }
    });
</script>
{% endblock %}