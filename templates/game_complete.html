<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temple of Mysteries - Victory!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #3d1f5c 50%, #6b2d5c 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ffd700;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }

        @keyframes explode {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        .completion-container {
            background: rgba(26, 10, 46, 0.95);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 50px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            animation: victoryAppear 1s ease-out;
            z-index: 10;
            position: relative;
        }

        @keyframes victoryAppear {
            0% {
                opacity: 0;
                transform: scale(0.5) rotateY(180deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
            }
        }

        h1 {
            text-align: center;
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            }
            to {
                text-shadow: 3px 3px 30px rgba(255, 215, 0, 1), 3px 3px 6px rgba(0, 0, 0, 0.8);
            }
        }

        .victory-message {
            text-align: center;
            font-size: 1.5em;
            color: #90ee90;
            margin-bottom: 30px;
            font-style: italic;
            animation: fadeIn 2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            text-transform: capitalize;
        }

        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #ffd700, transparent);
            margin: 30px 0;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(61, 31, 92, 0.6);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffd700;
            text-align: center;
            animation: statAppear 1s ease-out backwards;
        }

        .stat-card:nth-child(1) { animation-delay: 0.2s; }
        .stat-card:nth-child(2) { animation-delay: 0.4s; }
        .stat-card:nth-child(3) { animation-delay: 0.6s; }
        .stat-card:nth-child(4) { animation-delay: 0.8s; }

        @keyframes statAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-label {
            color: #c9a961;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }

        .achievement-message {
            background: rgba(107, 45, 92, 0.5);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #90ee90;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.1em;
            line-height: 1.8;
            color: #e6d7b8;
        }

        .button-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 20px 40px;
            background: linear-gradient(135deg, #ffd700 0%, #c9a961 100%);
            border: none;
            border-radius: 10px;
            color: #1a0a2e;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
            text-decoration: none;
            display: inline-block;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
        }

        .action-button:active {
            transform: translateY(-1px);
        }

        .action-button.secondary {
            background: linear-gradient(135deg, #6b2d5c 0%, #3d1f5c 100%);
            color: #ffd700;
            border: 2px solid #ffd700;
        }

        .trophy {
            text-align: center;
            font-size: 6em;
            margin: 20px 0;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        @media (max-width: 768px) {
            .completion-container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2.5em;
            }

            .victory-message {
                font-size: 1.2em;
            }

            .trophy {
                font-size: 4em;
            }

            .stats-container {
                grid-template-columns: 1fr 1fr;
            }

            .action-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="completion-container">
        <h1>üéâ Victory! üéâ</h1>
        
        <div class="trophy">üèÜ</div>

        <div class="victory-message">
            Congratulations, <span class="player-name" id="player-name">Hero</span>!<br>
            You have escaped the Temple of Mysteries!
        </div>

        <div class="divider"></div>

        <div class="achievement-message">
            Through wit, wisdom, and unwavering determination, you have conquered all four chambers of the ancient temple. 
            The sacred seals have been broken, and the path to freedom now lies open before you. 
            Your name shall be remembered in the annals of legendary adventurers who dared to challenge the temple's mysteries.
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-label">Final HP</div>
                <div class="stat-value" id="final-hp">100</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Intelligence</div>
                <div class="stat-value" id="final-intelligence">40</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total XP</div>
                <div class="stat-value" id="final-exp">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Items Found</div>
                <div class="stat-value" id="items-collected">4</div>
            </div>
        </div>

        <div class="divider"></div>

        <div class="button-container">
            <a href="/game" class="action-button">‚öîÔ∏è Play Again ‚öîÔ∏è</a>
            <a href="/logout" class="action-button secondary">üö™ Exit Temple üö™</a>
        </div>
    </div>

    <script>
        // Fetch final player stats
        async function loadFinalStats() {
            try {
                const response = await fetch('/api/player');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('player-name').textContent = data.username || 'Hero';
                    document.getElementById('final-hp').textContent = data.hp || 100;
                    document.getElementById('final-intelligence').textContent = data.intelligence || 40;
                    document.getElementById('final-exp').textContent = data.experience || 0;
                    
                    // Count items
                    const items = data.inventory ? data.inventory.split(',').filter(i => i.trim()).length : 0;
                    document.getElementById('items-collected').textContent = items;
                }
            } catch (error) {
                console.error('Failed to load final stats:', error);
            }
        }

        // Create fireworks effect
        function createFirework(x, y) {
            const colors = ['#ffd700', '#ff6b6b', '#4caf50', '#2196f3', '#ff4757', '#90ee90'];
            const particles = 30;
            
            for (let i = 0; i < particles; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (Math.PI * 2 * i) / particles;
                const velocity = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                firework.style.setProperty('--tx', tx + 'px');
                firework.style.setProperty('--ty', ty + 'px');
                
                document.body.appendChild(firework);
                
                setTimeout(() => firework.remove(), 1000);
            }
        }

        // Launch fireworks randomly
        function launchFireworks() {
            const interval = setInterval(() => {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                createFirework(x, y);
            }, 800);

            // Stop after 10 seconds
            setTimeout(() => clearInterval(interval), 10000);
        }

        // Initialize
        loadFinalStats();
        setTimeout(launchFireworks, 500);

        // Create initial burst of fireworks
        for (let i = 0; i < 5; i++) {
            setTimeout(() => {
                createFirework(
                    Math.random() * window.innerWidth,
                    Math.random() * window.innerHeight
                );
            }, i * 200);
        }
    </script>
</body>
</html>
