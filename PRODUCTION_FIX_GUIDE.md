# 本番環境での「リクエストが見つかりません」エラー対処法

## 既存コードを変更せずに解決する方法

### 1. 新しい起動方法

既存の `abcd.py` を直接実行する代わりに、新しく作成したファイルを使用してください：

```cmd
# 本番環境用バッチファイルで起動（推奨）
start_production.bat

# または直接Pythonで起動
python production_server.py
```

### 2. 環境変数の設定

以下の環境変数を設定してください：

```cmd
set SECRET_KEY=your_secure_key_here
set FLASK_ENV=production
set HOST=0.0.0.0
set PORT=5000
```

### 3. 健全性チェックの実行

問題を事前に発見するため、定期的に健全性チェックを実行してください：

```cmd
python health_check.py
```

### 4. よくある問題と解決法

#### 問題1: 404エラー（ページが見つからない）
**原因**: ルートパスの解決ができていない  
**解決法**: 新しいエラーハンドラーが自動的に処理します

#### 問題2: 500エラー（内部サーバーエラー）
**原因**: テンプレートファイルが見つからない  
**解決法**: health_check.pyで事前にファイルの存在を確認

#### 問題3: 静的ファイルが読み込めない
**原因**: パス設定の問題  
**解決法**: config.pyで適切なパス設定を行いました

#### 問題4: プロキシサーバー経由でアクセスできない
**原因**: プロキシヘッダーの処理不足  
**解決法**: ProxyFixミドルウェアで対応

### 5. トラブルシューティング手順

1. **健全性チェックの実行**
   ```cmd
   python health_check.py
   ```

2. **ログファイルの確認**
   ```cmd
   type tmhk_chat.log
   ```

3. **データベースの確認**
   ```cmd
   # データベースファイルの存在確認
   dir abc.db
   ```

4. **ポートの確認**
   ```cmd
   netstat -an | findstr :5000
   ```

### 6. 既存コードとの関係

- `abcd.py`: **変更なし** - 既存の機能はそのまま維持
- 新しいファイルは既存コードを拡張するだけで、既存機能に影響しません
- 開発環境では従来通り `python abcd.py` で動作します

### 7. 本番環境での推奨設定

```cmd
# 本番環境用環境変数（.batファイルまたはシステム環境変数で設定）
set SECRET_KEY=長く複雑なランダム文字列
set FLASK_ENV=production
set HOST=0.0.0.0
set PORT=5000
set PREFERRED_URL_SCHEME=https  # HTTPSを使用する場合
```

### 8. 監視とメンテナンス

- `tmhk_chat.log` ファイルでエラーログを確認
- 定期的に `health_check.py` を実行
- データベースファイル `abc.db` の定期バックアップ

### 9. 緊急時の対応

問題が発生した場合：

1. 健全性チェックを実行
2. ログファイルを確認
3. 必要に応じて従来の方法 (`python abcd.py`) で起動
4. 問題が解決しない場合は開発環境で動作確認

この方法により、既存のコードを一切変更することなく、本番環境での問題を解決できます。