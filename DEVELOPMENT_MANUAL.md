# ã€ŒTMHKchatã€é–‹ç™ºãƒ»é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

**ä½œæˆæ—¥**: 2025å¹´9æœˆ28æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æ›´æ–°æ—¥**: 2025å¹´11æœˆ14æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [é–‹ç™ºã®æµã‚Œï¼ˆä¸€ç•ªã‚ˆãä½¿ã†æ‰‹é †ï¼‰](#1-é–‹ç™ºã®æµã‚Œä¸€ç•ªã‚ˆãä½¿ã†æ‰‹é †)
2. [ã‚µãƒ¼ãƒãƒ¼ã®å‹•ä½œç¢ºèªï¼ˆæ§˜å­ãŒãŠã‹ã—ã„ã¨ãï¼‰](#2-ã‚µãƒ¼ãƒãƒ¼ã®å‹•ä½œç¢ºèªæ§˜å­ãŒãŠã‹ã—ã„ã¨ã)
3. [åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †](#3-åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †)
4. [ç’°å¢ƒåˆ¥ã®è¨­å®š](#4-ç’°å¢ƒåˆ¥ã®è¨­å®š)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†](#5-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†)
6. [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢](#6-ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢)
7. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–](#7-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–)
8. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#8-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
9. [ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰](#9-ã‚ˆãã‚ã‚‹è³ªå•faq)

---

## 1. é–‹ç™ºã®æµã‚Œï¼ˆä¸€ç•ªã‚ˆãä½¿ã†æ‰‹é †ï¼‰

ã“ã®æ‰‹é †ã¯ã€ãƒ‘ã‚½ã‚³ãƒ³ã§ä¿®æ­£ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã‚µãƒ¼ãƒãƒ¼ã«åæ˜ ã•ã›ã‚‹ã¨ãã«æ¯å›ä½¿ã„ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‘ã‚½ã‚³ãƒ³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¿®æ­£ã™ã‚‹

ã¾ãšã€è‡ªåˆ†ã®ãƒ‘ã‚½ã‚³ãƒ³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¿®æ­£ã‚„æ©Ÿèƒ½è¿½åŠ ã‚’è¡Œã„ã¾ã™ã€‚

#### ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã

**Windows**:
```
C:\Users\skyto\Documents\server
```

**Linux/Mac**:
```bash
~/tmhk-chat-server
```

#### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹

- **ãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬ä½“**: `app.py`
- **HTMLãªã©ç”»é¢ã®è¦‹ãŸç›®**: `templates` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«
- **CSS/JavaScript**: `static/css/`, `static/js/` å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹**: `services/` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«
- **ä½¿ã„ãŸã„éƒ¨å“ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‚’è¿½åŠ ã—ãŸå ´åˆ**: `requirements.txt` ã«åå‰ã‚’è¿½è¨˜

#### ï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚„Finderã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‰Šé™¤ã™ã‚‹ã ã‘ã§OKã§ã™ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—2: ä¿®æ­£å†…å®¹ã‚’GitHubã«è¨˜éŒ²ãƒ»ä¿ç®¡ã™ã‚‹

æ¬¡ã«ã€ãƒ‘ã‚½ã‚³ãƒ³ã§ã®ä¿®æ­£å†…å®¹ã‚’GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ä½œæ¥­ã¯ **Git Bash** (Windows) ã¾ãŸã¯ **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«** (Mac/Linux) ã§è¡Œã„ã¾ã™ã€‚

#### 1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆGit Bashï¼‰ã‚’é–‹ãã€ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹

**Windows (Git Bash)**:
```bash
cd ~/Documents/server
```

**Linux/Mac**:
```bash
cd ~/tmhk-chat-server
```

#### 2. å¤‰æ›´ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã™ã‚‹ï¼ˆä»»æ„ï¼‰

```bash
git status
```

**è¡¨ç¤ºä¾‹**:
```
modified:   app.py
modified:   templates/chat.html
new file:   static/js/new-feature.js
```

#### 3. å…¨ã¦ã®å¤‰æ›´ã‚’è¨˜éŒ²ã®å¯¾è±¡ã«ã™ã‚‹

```bash
git add .
```

ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã‚’è¿½åŠ ã—ãŸã„å ´åˆã¯ã€`git add ãƒ•ã‚¡ã‚¤ãƒ«å` ã‚’ä½¿ã„ã¾ã™ã€‚

#### 4. å¤‰æ›´å†…å®¹ã«ãƒ¡ãƒ¢ï¼ˆã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã‚’ä»˜ã‘ã¦è¨˜éŒ²ã‚’ç¢ºå®šã™ã‚‹

```bash
git commit -m "â—‹â—‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ "
```

**è‰¯ã„ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¾‹**:
- âœ… `git commit -m "ãƒãƒ£ãƒƒãƒˆç”»é¢ã«ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡æ©Ÿèƒ½ã‚’è¿½åŠ "`
- âœ… `git commit -m "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’ä¿®æ­£"`
- âœ… `git commit -m "ãƒã‚°ä¿®æ­£: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤æ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆ"`

**æ‚ªã„ä¾‹**:
- âŒ `git commit -m "ä¿®æ­£"`
- âŒ `git commit -m "update"`
- âŒ `git commit -m "ã‚ã‚ã‚"`

ğŸ’¡ **ãƒ’ãƒ³ãƒˆ**: ã€Œã€ã®ä¸­èº«ã¯ã€ä½•ã‚’å¤‰æ›´ã—ãŸã‹åˆ†ã‹ã‚‹ã‚ˆã†ã«å…·ä½“çš„ã«æ›¸ãã¨å¾Œã§è¦‹è¿”ã—ãŸã¨ãã«ä¾¿åˆ©ã§ã™ã€‚

#### 5. GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

```bash
git push origin main
```

**åˆå›ã®å ´åˆ**: GitHubã®èªè¨¼ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆã¾ãŸã¯Personal Access Tokenï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚µãƒ¼ãƒãƒ¼ã«ä¿®æ­£å†…å®¹ã‚’åæ˜ ã•ã›ã‚‹

æœ€å¾Œã«ã€GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸæœ€æ–°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã€AWSã‚µãƒ¼ãƒãƒ¼ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å‹•ã‹ã—ã¾ã™ã€‚

#### 1. ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ï¼ˆSSHæ¥ç¶šï¼‰

**Windows (Git Bash) / Mac / Linux**:
```bash
ssh -i "tmhk-chat.pem" ubuntu@52.69.241.31
```

âš ï¸ **æ³¨æ„**: `tmhk-chat.pem` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

**PEMãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€**:
- Windows: `C:\Users\skyto\.ssh\tmhk-chat.pem`
- Mac/Linux: `~/.ssh/tmhk-chat.pem`

**åˆå›æ¥ç¶šæ™‚ã®ã‚¨ãƒ©ãƒ¼å¯¾å‡¦**:
```bash
# Windowsã®å ´åˆ
chmod 400 tmhk-chat.pem

# Mac/Linuxã®å ´åˆ
chmod 400 ~/.ssh/tmhk-chat.pem
```

#### 2. ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹

```bash
cd ~/tmhk-chat-server
```

#### 3. GitHubã‹ã‚‰æœ€æ–°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

```bash
git pull origin main
```

**è¡¨ç¤ºä¾‹**:
```
remote: Counting objects: 5, done.
remote: Compressing objects: 100% (3/3), done.
Updating abc1234..def5678
Fast-forward
 app.py                | 10 +++++++++-
 templates/chat.html   |  5 +++++
 2 files changed, 14 insertions(+), 1 deletion(-)
```

#### 4. ï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰æ–°ã—ã„éƒ¨å“ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

âš ï¸ **æ³¨æ„**: `requirements.txt` ã‚’å¤‰æ›´ã—ãŸå ´åˆã®ã¿ã€ã“ã®æ‰‹é †ãŒå¿…è¦ã§ã™ã€‚

```bash
# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–
source venv/bin/activate

# æ–°ã—ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª**:
```bash
pip list
```

#### 5. ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•ã—ã¦ã€ä¿®æ­£ã‚’åæ˜ ã•ã›ã‚‹

```bash
pm2 restart tmhk-chat
```

**æˆåŠŸæ™‚ã®è¡¨ç¤ºä¾‹**:
```
[PM2] Applying action restartProcessId on app [tmhk-chat](ids: [ 0 ])
[PM2] [tmhk-chat](0) âœ“
```

ã“ã‚Œã§ã€Webã‚µã‚¤ãƒˆãŒæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

#### 6. ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œç¢ºèª

```
http://52.69.241.31
```

ã¾ãŸã¯ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã‚ã‚‹å ´åˆ:
```
https://your-domain.com
```

---

## 2. ã‚µãƒ¼ãƒãƒ¼ã®å‹•ä½œç¢ºèªï¼ˆæ§˜å­ãŒãŠã‹ã—ã„ã¨ãï¼‰

ã‚¢ãƒ—ãƒªãŒã†ã¾ãå‹•ã‹ãªã„ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€ã¨ã„ã†ã¨ãã«ä½¿ã„ã¾ã™ã€‚

### ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šå¾Œã€ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹

```bash
pm2 list
```

**è¡¨ç¤ºä¾‹**:
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name         â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ tmhk-chat    â”‚ default     â”‚ N/A     â”‚ fork    â”‚ 12345    â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- `status` ãŒ `online` ãªã‚‰æ­£å¸¸ã«å‹•ã„ã¦ã„ã¾ã™ã€‚
- `status` ãŒ `errored` ã‚„ `stopped` ã«ãªã£ã¦ã„ãŸã‚‰ã€ä½•ã‹å•é¡ŒãŒèµ·ãã¦ã„ã¾ã™ã€‚

### ã‚¨ãƒ©ãƒ¼ã®åŸå› ï¼ˆãƒ­ã‚°ï¼‰ã‚’ç¢ºèªã™ã‚‹

```bash
pm2 logs tmhk-chat
```

**ãƒ­ã‚°è¡¨ç¤ºä¾‹**:
```
[TAILING] Tailing last 15 lines for [tmhk-chat] process
/home/ubuntu/.pm2/logs/tmhk-chat-out.log last 15 lines:
0|tmhk-cha | [2025-11-14 10:30:00] INFO: Starting application...
0|tmhk-cha | [2025-11-14 10:30:01] INFO: Database connected
0|tmhk-cha | [2025-11-14 10:30:02] ERROR: File not found: template.html
```

- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã®å†…å®¹ã‚’ãƒ’ãƒ³ãƒˆã«åŸå› ã‚’æ¢ã‚Šã¾ã™ã€‚
- ãƒ­ã‚°è¡¨ç¤ºã‚’æ­¢ã‚ã‚‹ã¨ãã¯ `Ctrl + C` ã‚’æŠ¼ã—ã¾ã™ã€‚

### ãã®ä»–ã®ä¾¿åˆ©ãªPM2ã‚³ãƒãƒ³ãƒ‰

```bash
# ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
pm2 stop tmhk-chat

# ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹
pm2 start tmhk-chat

# ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†èµ·å‹•
pm2 restart all

# ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
pm2 show tmhk-chat

# PM2ã®è¨­å®šã‚’ä¿å­˜ï¼ˆå†èµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•ï¼‰
pm2 save

# ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã®è‡ªå‹•èµ·å‹•ã‚’è¨­å®š
pm2 startup
```

---

## 3. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ã«åˆã‚ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã®æ‰‹é †

#### 1. ã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶š

```bash
ssh -i "tmhk-chat.pem" ubuntu@52.69.241.31
```

#### 2. ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–°

```bash
sudo apt update
sudo apt upgrade -y
```

#### 3. å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Python 3.12ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install python3.12 python3.12-venv python3-pip -y

# Gitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install git -y

# Node.jsã¨npmã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆPM2ç”¨ï¼‰
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# PM2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo npm install -g pm2
```

#### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
cd ~
git clone https://github.com/sakai-tomohiko124/tmhk-chat-server.git
cd tmhk-chat-server
```

#### 5. ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ

```bash
python3.12 -m venv venv
source venv/bin/activate
```

#### 6. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

#### 7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–

```bash
python -c "from app import init_db; init_db()"
```

#### 8. ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ

```bash
python scripts/create_admin.py
```

**å…¥åŠ›ä¾‹**:
```
ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å: admin
ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: your-secure-password
```

#### 9. PM2ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /home/ubuntu/tmhk-chat-server

# PM2ã§èµ·å‹•
pm2 start ./venv/bin/gunicorn \
  --name tmhk-chat \
  --interpreter ./venv/bin/python \
  -- --workers 3 --bind unix:chat.sock -m 007 app:app

# è¨­å®šã‚’ä¿å­˜
pm2 save

# ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã®è‡ªå‹•èµ·å‹•ã‚’æœ‰åŠ¹åŒ–
pm2 startup
```

#### 10. Nginxã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
# Nginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install nginx -y

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
sudo nano /etc/nginx/sites-available/tmhk-chat
```

**è¨­å®šå†…å®¹**:
```nginx
server {
    listen 80;
    server_name 52.69.241.31;  # ã¾ãŸã¯ your-domain.com

    location / {
        proxy_pass http://unix:/home/ubuntu/tmhk-chat-server/chat.sock;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /socket.io {
        proxy_pass http://unix:/home/ubuntu/tmhk-chat-server/chat.sock;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

**è¨­å®šã‚’æœ‰åŠ¹åŒ–**:
```bash
# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
sudo ln -s /etc/nginx/sites-available/tmhk-chat /etc/nginx/sites-enabled/

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å‰Šé™¤
sudo rm /etc/nginx/sites-enabled/default

# è¨­å®šã‚’ãƒ†ã‚¹ãƒˆ
sudo nginx -t

# Nginxã‚’å†èµ·å‹•
sudo systemctl restart nginx
```

---

## 4. ç’°å¢ƒåˆ¥ã®è¨­å®š

### é–‹ç™ºç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«PCï¼‰

**.env ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**:
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
SECRET_KEY=dev-secret-key
FLASK_ENV=development
DEBUG=True
DATABASE_PATH=chat_dev.db
```

**èµ·å‹•ã‚³ãƒãƒ³ãƒ‰**:
```bash
python app.py
```

### ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ

```bash
SECRET_KEY=staging-secret-key
FLASK_ENV=staging
DEBUG=False
DATABASE_PATH=chat_staging.db
```

### æœ¬ç•ªç’°å¢ƒï¼ˆAWSï¼‰

```bash
SECRET_KEY=production-secret-key-change-this
FLASK_ENV=production
DEBUG=False
DATABASE_PATH=/var/lib/tmhk-chat/chat.db
OPENAI_API_KEY=your-openai-api-key
GEMINI_API_KEY=your-gemini-api-key
```

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp chat.db chat_backup_$(date +%Y%m%d_%H%M%S).db

# å®šæœŸçš„ãªè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆcronã«è¨­å®šï¼‰
crontab -e
```

**cronè¨­å®šä¾‹ï¼ˆæ¯æ—¥åˆå‰3æ™‚ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰**:
```cron
0 3 * * * cd /home/ubuntu/tmhk-chat-server && cp chat.db /home/ubuntu/backups/chat_$(date +\%Y\%m\%d).db
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª

```bash
python scripts/check_db.py
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚¹ãƒˆã‚¢

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
pm2 stop tmhk-chat

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp chat_backup_20251114_100000.db chat.db

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•
pm2 restart tmhk-chat
```

---

## 6. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢

### å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/bin/bash
# backup.sh

BACKUP_DIR="/home/ubuntu/backups"
PROJECT_DIR="/home/ubuntu/tmhk-chat-server"
DATE=$(date +%Y%m%d_%H%M%S)

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p $BACKUP_DIR

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp $PROJECT_DIR/chat.db $BACKUP_DIR/chat_$DATE.db

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz $PROJECT_DIR/static/assets/uploads

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šå‰ï¼‰
find $BACKUP_DIR -name "chat_*.db" -mtime +30 -delete
find $BACKUP_DIR -name "uploads_*.tar.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
```

**å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸**:
```bash
chmod +x backup.sh
```

**cronã§è‡ªå‹•åŒ–**:
```cron
0 3 * * * /home/ubuntu/tmhk-chat-server/backup.sh >> /var/log/tmhk-backup.log 2>&1
```

---

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

### 1. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š

```bash
# UFWã‚’æœ‰åŠ¹åŒ–
sudo ufw enable

# SSHï¼ˆãƒãƒ¼ãƒˆ22ï¼‰ã‚’è¨±å¯
sudo ufw allow 22/tcp

# HTTPï¼ˆãƒãƒ¼ãƒˆ80ï¼‰ã‚’è¨±å¯
sudo ufw allow 80/tcp

# HTTPSï¼ˆãƒãƒ¼ãƒˆ443ï¼‰ã‚’è¨±å¯
sudo ufw allow 443/tcp

# çŠ¶æ…‹ç¢ºèª
sudo ufw status
```

### 2. SSL/TLSè¨¼æ˜æ›¸ã®è¨­å®šï¼ˆLet's Encryptï¼‰

```bash
# Certbotã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install certbot python3-certbot-nginx -y

# SSLè¨¼æ˜æ›¸ã‚’å–å¾—
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è‡ªå‹•æ›´æ–°ã®ãƒ†ã‚¹ãƒˆ
sudo certbot renew --dry-run
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š

**Nginxè¨­å®šã«è¿½åŠ **:
```nginx
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
```

---

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### Gunicornãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã®èª¿æ•´

**æ¨å¥¨è¨­å®š**: `(2 Ã— CPUæ•°) + 1`

```bash
# CPUæ•°ã‚’ç¢ºèª
nproc

# ä¾‹: 2ã‚³ã‚¢ã®å ´åˆã€5ãƒ¯ãƒ¼ã‚«ãƒ¼
pm2 start ./venv/bin/gunicorn \
  --name tmhk-chat \
  --interpreter ./venv/bin/python \
  -- --workers 5 --bind unix:chat.sock -m 007 app:app
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

```bash
# SQLiteã®æœ€é©åŒ–
sqlite3 chat.db "VACUUM;"
sqlite3 chat.db "ANALYZE;"
```

### ãƒ­ã‚°ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# /etc/logrotate.d/tmhk-chat ã‚’ä½œæˆ
sudo nano /etc/logrotate.d/tmhk-chat
```

**å†…å®¹**:
```
/home/ubuntu/.pm2/logs/tmhk-chat*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 ubuntu ubuntu
    sharedscripts
    postrotate
        pm2 reloadLogs
    endscript
}
```

---

## 9. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

### Q1: `git push`æ™‚ã«èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

**A**: Personal Access Tokenã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

```bash
# GitHubã§Personal Access Tokenã‚’ä½œæˆ
# Settings > Developer settings > Personal access tokens > Generate new token

# èªè¨¼æƒ…å ±ã‚’ä¿å­˜
git config --global credential.helper store

# æ¬¡å›ã®pushæ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›
git push origin main
# Username: your-github-username
# Password: ghp_xxxxxxxxxxxxxxxxxxxxï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
```

### Q2: PM2èµ·å‹•æ™‚ã«`EACCES`ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

**A**: Unixã‚½ã‚±ãƒƒãƒˆã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# ã‚½ã‚±ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’å¤‰æ›´
chmod 666 chat.sock

# ã¾ãŸã¯ã€PM2ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã§æ˜ç¤ºçš„ã«æŒ‡å®š
pm2 start ./venv/bin/gunicorn \
  --name tmhk-chat \
  --interpreter ./venv/bin/python \
  -- --workers 3 --bind unix:chat.sock --umask 007 app:app
```

### Q3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå£Šã‚ŒãŸ

**A**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒã—ã¦ãã ã•ã„ã€‚

```bash
pm2 stop tmhk-chat
cp chat_backup_latest.db chat.db
pm2 restart tmhk-chat
```

### Q4: ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

**A**: ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã‚’æ¸›ã‚‰ã™ã‹ã€ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ã€‚

```bash
# ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã‚’æ¸›ã‚‰ã™
pm2 delete tmhk-chat
pm2 start ./venv/bin/gunicorn \
  --name tmhk-chat \
  --interpreter ./venv/bin/python \
  -- --workers 2 --bind unix:chat.sock -m 007 app:app
```

### Q5: Socket.IOãŒæ¥ç¶šã§ããªã„

**A**: Nginxè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```bash
# Nginxã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
sudo tail -f /var/log/nginx/error.log

# è¨­å®šã‚’ãƒ†ã‚¹ãƒˆ
sudo nginx -t

# Nginxã‚’å†èµ·å‹•
sudo systemctl restart nginx
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆãƒ»ãŠå•ã„åˆã‚ã›

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã§ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã‚‰ã‚Œã¾ã™:

1. **GitHubã®Issues**: https://github.com/sakai-tomohiko124/tmhk-chat-server/issues
2. **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª**: `pm2 logs tmhk-chat`
3. **ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã®ç¢ºèª**: `/var/log/nginx/error.log`

---

**ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®æ›´æ–°å±¥æ­´**:
- 2025å¹´9æœˆ28æ—¥: åˆç‰ˆä½œæˆ
- 2025å¹´11æœˆ14æ—¥: è©³ç´°ãªæ‰‹é †ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¿½åŠ 
